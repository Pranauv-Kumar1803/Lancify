<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<link rel="stylesheet" href="/css/preview.css" type="text/css">

	<link rel="stylesheet" href="/css/styles.css" type="text/css">

</head>

<body>
	<%- include('../partials/navbar.ejs',{isLoggedIn:login}) %>

		<div class="root py-10 ">
			<section>
				<div class="flex flex-row justify-center items-start w-full">
					<div class="flex justify-end w-1/2 p-5">
						<img class="w-full" src="<%= service.main_img %>" alt="">
					</div>
					<div class="flex justify-center w-1/2 p-5">
						<div class="profile w-full">
							<h1 class="fs-3 head " id="service_title"><%= service.seller_title %></h1>
							<p class="hidden" id="service_id"><%= service._id %></p>
							<div class="child-flex border-set-bottom">
								<div class="w-20 h-20 rounded "><img class="w-20 h-20 rounded-full"
										src="<%= service.seller_img %>" alt=""></div>

								<div class="align-star">
									<span class="rating">
										<%= service.rating %>
									</span>
									<span class="fa fa-star checked gold"></span>
								</div>
								<div class="right--most">
										<h3 class="align-star naming--pos" ><a href="/profile/<%= service.seller_id %>" class="hover:cursor-pointer" id="seller_name"><%= service.seller_name %></a></h3>
								</div>
							</div>
							<article class="info-block md:decoration-4">
								<%= seller.seller_desc %>
							</article>
						</div>
					</div>
				</div>
			</section>

			<section class="card--profile--component py-10">
				<% if(check !== undefined) { %>
					<p class="hidden" id="check">
						<%= check._id %>
					</p>
				<% } %>
				<h1 class="text-3xl text-white flex justify-center items-center text-center mx-auto">About this
					gig</h1>
				<section class="text-gray-600 body-font">
					<div
						class="container mx-auto flex px-5 py-10 md:flex-row flex-col justify-center items-center">
						<div
							class="lg:flex-grow md:w-1/2 flex flex-col justify-center md:items-start md:text-left mb-16 md:mb-0 items-center text-center">
							<p class="mb-8 leading-relaxed mx-auto text-center decoration-1 text-white">
								<%= service.seller_desc %>
							</p>
							<button type="button" id="contact"
								class="btn rouded p-3 text-center mx-auto bg-light_green text-white"> Contact
								this
								Seller!</button>
						</div>
					</div>
				</section>
			</section>

			<section class="text-gray-600 body-font overflow-hidden">
				<h1 class="text-3xl text-white flex justify-center items-center text-center mx-auto">Pricing and
					Services</h1>
				<div class="container px-5 py-10 mx-auto">
					<div class="flex flex-wrap -m-4 cc">
						<% service.services.forEach((s,index)=>{ %>
							<% if(index==0) { %>
								<div class="p-4 xl:w-1/4 md:w-1/2 w-full ">
									<div
										class="h-full p-6 rounded-lg border-2 border-gray-300 flex flex-col relative overflow-hidden">
										<h2 class="text-sm tracking-widest title-font mb-1 font-medium text-white"
											id="type_service1">BASIC
										</h2>
										<h1 class="text-5xl text-white pb-4 mb-4 border-b border-gray-200 leading-none">
											<span id="price1">₹<%= s.starting_price %></span>
										</h1>
										<% s.services.forEach((p)=>{ %>
											<p class="flex items-center text-white mb-2">
												<span
													class="w-4 h-4 mr-2 inline-flex items-center justify-center bg-gray-400 text-white rounded-full flex-shrink-0">
													<svg fill="none" stroke="currentColor" stroke-linecap="round"
														stroke-linejoin="round" stroke-width="2.5" class="w-3 h-3"
														viewBox="0 0 24 24">
														<path d="M20 6L9 17l-5-5"></path>
													</svg>
												</span>
												<%= p %>
											</p>
											<% }) %>
												<button id="submit1"
													class="checkout flex items-center mt-auto text-white bg-gray-400 border-0 py-2 px-4 w-full focus:outline-none hover:bg-gray-500 rounded">Proceed
													to Checkout!
													<svg fill="none" stroke="currentColor" stroke-linecap="round"
														stroke-linejoin="round" stroke-width="2" class="w-4 h-4 ml-auto"
														viewBox="0 0 24 24">
														<path d="M5 12h14M12 5l7 7-7 7"></path>
													</svg>
												</button>
									</div>
								</div>
								<% } else if(index==1) { %>
									<div class="p-4 xl:w-1/4 md:w-1/2 w-full bord">
										<div
											class="h-full p-6 rounded-lg border-2 border-light_green flex flex-col relative overflow-hidden">
											<span
												class="bg-light_green text-white px-3 py-1 tracking-widest text-xs absolute right-0 top-0 rounded-bl"
												id="type_service2">POPULAR</span>
											<h2 class="text-sm tracking-widest title-font mb-1 font-medium text-white">
												PRO</h2>
											<h1
												class="text-5xl text-white leading-none flex items-center pb-4 mb-4 border-b border-gray-200">
												<span id="price2">₹<%= s.starting_price %></span>
											</h1>
											<% s.services.forEach((p)=>{ %>
												<p class="flex items-center text-white mb-2">
													<span
														class="w-4 h-4 mr-2 inline-flex items-center justify-center bg-gray-400 text-white rounded-full flex-shrink-0">
														<svg fill="none" stroke="currentColor" stroke-linecap="round"
															stroke-linejoin="round" stroke-width="2.5" class="w-3 h-3"
															viewBox="0 0 24 24">
															<path d="M20 6L9 17l-5-5"></path>
														</svg>
													</span>
													<%= p %>
												</p>
												<% }) %>
													<button id="submit2"
														class="checkout flex items-center mt-auto text-white bg-light_green border-0 py-2 px-4 w-full focus:outline-none hover:cursor-pointer rounded">Proceed
														to Checkout!
														<svg fill="none" stroke="currentColor" stroke-linecap="round"
															stroke-linejoin="round" stroke-width="2"
															class="w-4 h-4 ml-auto" viewBox="0 0 24 24">
															<path d="M5 12h14M12 5l7 7-7 7"></path>
														</svg>
													</button>
										</div>
									</div>
									<% } else if(index==2) { %>
										<div class="p-4 xl:w-1/4 md:w-1/2 w-full ">
											<div
												class="h-full p-6 rounded-lg border-2 border-gray-300 flex flex-col relative overflow-hidden">
												<h2 class="text-sm tracking-widest title-font mb-1 font-medium text-white"
													id="type_service3">
													BUSINESS</h2>
												<h1
													class="text-5xl text-white leading-none flex items-center pb-4 mb-4 border-b border-gray-200">
													<span id="price3">₹<%= s.starting_price %></span>
												</h1>
												<% s.services.forEach((p)=>{ %>
													<p class="flex items-center text-white mb-2">
														<span
															class="w-4 h-4 mr-2 inline-flex items-center justify-center bg-gray-400 text-white rounded-full flex-shrink-0">
															<svg fill="none" stroke="currentColor"
																stroke-linecap="round" stroke-linejoin="round"
																stroke-width="2.5" class="w-3 h-3" viewBox="0 0 24 24">
																<path d="M20 6L9 17l-5-5"></path>
															</svg>
														</span>
														<%= p %>
													</p>
													<% }) %>
														<button id="submit3"
															class="checkout flex items-center mt-auto text-white bg-gray-400 border-0 py-2 px-4 w-full focus:outline-none hover:bg-gray-500 rounded">Proceed
															to Checkout!
															<svg fill="none" stroke="currentColor"
																stroke-linecap="round" stroke-linejoin="round"
																stroke-width="2" class="w-4 h-4 ml-auto"
																viewBox="0 0 24 24">
																<path d="M5 12h14M12 5l7 7-7 7"></path>
															</svg>
														</button>
											</div>
										</div>
										<% } %>
											<% }) %>

					</div>
				</div>
			</section>



			<section class="text-white body-font cc">
				<div class="container px-5 py-24 mx-auto">
					<div class="flex flex-wrap -m-4 text-center" style="
                    justify-content: space-evenly;
                ">
						<div class="p-4 sm:w-1/4 w-1/2">
							<h2 class="title-font font-medium sm:text-4xl text-3xl text-white">
								<%= service.numCustomers %>+
							</h2>
							<p class="leading-relaxed">Customers</p>
						</div>
						<div class="p-4 sm:w-1/4 w-1/2">
							<h2 class="title-font font-medium sm:text-4xl text-3xl text-white">
								<%= service.numReviews %>+
							</h2>
							<p class="leading-relaxed">Ratings</p>
						</div>
						<div class="p-4 sm:w-1/4 w-1/2">
							<h2 class="title-font font-medium sm:text-4xl text-3xl text-white">
								<%= service.avgResponseTime %> hr
							</h2>
							<p class="leading-relaxed">Response time</p>
						</div>
						<div class="p-4 sm:w-1/4 w-1/2">
							<h2 class="title-font font-medium sm:text-4xl text-3xl text-white">~<%=
									service.avgCompletionDuration %> d</h2>
							<p class="leading-relaxed">Completion duration</p>
						</div>
					</div>
				</div>
				<p class="hidden" id="full"><%= JSON.stringify(service) %></p>
			</section>

		</div>

		<script>
			const check = document.getElementById('check');

			if (check !== null) {
				const btns = document.getElementsByClassName('checkout');
				for (let i = 0; i < btns.length; i++) {
					const ele = btns[i];
					ele.disabled = true;
				}
			}

			const full = document.getElementById('full').innerHTML;

			const btn1 = document.getElementById('submit1');
			const btn2 = document.getElementById('submit2');
			const btn3 = document.getElementById('submit3');
			
			const title = document.getElementById('service_title').innerHTML;
			const id = document.getElementById('service_id').innerHTML;
			const name = document.getElementById('seller_name').innerHTML;
			
			btn1.addEventListener('click', async (e) => {
				const price = document.getElementById('price1').innerHTML;
				const type = document.getElementById('type_service1').innerHTML;

				fetch('http://localhost:5500/create-checkout-session', {
					method: 'post',
					body: JSON.stringify({
						items: [
							{ service_id: id, title: title, type: type, unit_price: price, name },
						],
						service: full
					}
					),
					headers: {
						'Content-Type': 'application/json'
					}
				}).then(res => {
					if (res.ok) {
						return res.json();
					}
					console.log(res);
					return res.json().then(json => Promise.reject(json));
				}).then(async ({ url, order, payment }) => {
					if(confirm('Do you want to continue?')) {
						window.location.href = url;
					}
					else {
						console.log('inside');
						const res = await fetch('http://localhost:5500/deleteOrder',{
							method: 'post',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify({order,payment})
						});
						
						if(res.ok) {
							console.log('yes');
							alert('you pressed cancel!');
							window.location.reload();
						}
					}
				}).catch(e => {
					console.log(e);
				})
			})

			btn2.addEventListener('click', async (e) => {
				console.log('inside the btn2')
				const price = document.getElementById('price2').innerHTML;
				const type = document.getElementById('type_service2').innerHTML;

				fetch('http://localhost:5500/create-checkout-session', {
					method: 'post',
					body: JSON.stringify({
						items: [
							{ service_id: id, title: title, type: type, unit_price: price, name },
						],
						service: full
					}
					),
					headers: {
						'Content-Type': 'application/json'
					}
				}).then(res => {
					if (res.ok) {
						return res.json();
					}
					console.log(res);
					return res.json().then(json => Promise.reject(json));
				}).then(({ url }) => {
					if(confirm('Do you want to continue?')) {
						window.location.href = url;
					}
					else {
						alert('you pressed cancel!');
						window.location.reload();
					}
				}).catch(e => {
					console.log(e);
				})

			})

			btn3.addEventListener('click', async (e) => {
				const price = document.getElementById('price3').innerHTML;
				const type = document.getElementById('type_service3').innerHTML;

				fetch('http://localhost:5500/create-checkout-session', {
					method: 'post',
					body: JSON.stringify({
						items: [
							{ service_id: id, title: title, type: type, unit_price: price, name },
						],
						service: full
					}
					),
					headers: {
						'Content-Type': 'application/json'
					}
				}).then(res => {
					if (res.ok) {
						return res.json();
					}
					console.log(res);
					return res.json().then(json => Promise.reject(json));
				}).then(({ url }) => {
					if(confirm('Do you want to continue?')) {
						window.location.href = url;
					}
					else {
						alert('you pressed cancel!');
						window.location.reload();
					}
				}).catch(e => {
					console.log(e);
				})
			})
		</script>

		<%- include('../partials/footer.ejs') %>

</body>

</html>